define(["require","exports","utils/utils","utils/constants","utils/facebook-utils","utils/browser-api"],function(a,b,c,d,e,f){"use strict";var g=function(){function a(){}return a.closeFacebookColorDialog=function(){var a=document.querySelector(".layerCancel");a&&a.click()},a.getThreadColor=function(){var b=document.querySelector("a[data-testid=info_panel_button] path");return a.rgb2hex(b.style.fill)},a.hideRatingView=function(){var a=document.querySelector(".mauf-rating-overlay");a.parentNode.removeChild(a)},a.showRatingView=function(b){var e=document.querySelector("div[data-testid=info_panel]");if(e){var g,h,i,j=c.createElement,k=j("div",{className:"mauf-rating-overlay"},j("div",{className:"mauf-rating-wrapper"},j("img",{src:"https://fbstatic-a.akamaihd.net/images/emoji.php/v5/zf/1/128/1f618.png"}),j("span",{textContent:chrome.i18n.getMessage("rateMessage")}),i=j("a",{textContent:chrome.i18n.getMessage("rateAndroid"),href:d.EXTENSION_ANDROID_URL,target:"_blank",className:"mauf-rating-button-android"}),g=j("a",{href:d.EXTENSION_REVIEW_URL,target:"_blank",textContent:chrome.i18n.getMessage("rateNowButton"),className:"mauf-rating-button-rate"}),h=j("a",{textContent:chrome.i18n.getMessage("rateLaterButton"),className:"mauf-rating-button-later"})));f.Storage.set({usage_counter:b-1}),g.addEventListener("click",function(d){a.hideRatingView(),f.Storage.set({usage_counter:b}),c.logEventData({eventCategory:"rate",eventAction:"rate_now"})}),h.addEventListener("click",function(e){e.preventDefault(),a.hideRatingView(),f.Storage.set({usage_counter:b-d.REVIEW_LATER}),c.logEventData({eventCategory:"rate",eventAction:"rate_later"})}),i.addEventListener("click",function(a){c.logEventData({eventCategory:"rate",eventAction:"rate_android"})}),e.style.position="relative",e.appendChild(k),setTimeout(function(){h&&(h.style.display="block")},7e3)}},a.increaseUsageCounter=function(a){f.Storage.get("usage_counter",function(b){var c=b.usage_counter||0;++c,f.Storage.set({usage_counter:c}),a&&a(c)})},a.render=function(b,f,g){var h,i,j=c.createElement,k=j("div",{className:"mauf-wrapper"},j("div",{id:"mauf-jscolor-wrapper"}),h=j("input",{maxLength:7,className:"jscolor",value:a.getThreadColor()}),i=j("button",{textContent:chrome.i18n.getMessage("setColor")}),j("div",{className:"mauf-footer"},j("a",{href:d.EXTENSION_ANDROID_URL,target:"_blank",className:"mauf-android",textContent:chrome.i18n.getMessage("android")}),c.createTextNode(" - "),j("a",{href:d.EXTENSION_REVIEW_URL,target:"_blank",className:"mauf-review",textContent:chrome.i18n.getMessage("review")})));b.appendChild(k);var l=new jscolor(h,{container:"mauf-jscolor-wrapper",borderWidth:0,shadow:!1,showOnClick:!1,hideOnClick:!1,backgroundColor:"transparent",callback:function(){setTimeout(this.show,0)}});i.addEventListener("click",function(b){b.preventDefault();var h=l.toHEXString();h&&(e.changeThreadColor(h,f,g),a.closeFacebookColorDialog(),a.increaseUsageCounter(function(b){b%d.REVIEW_EVERY===d.REVIEW_EVERY_FIRST&&a.showRatingView(b)}),c.logEventData({eventCategory:"color",eventAction:"change_custom",eventLabel:h}))});for(var m=b.querySelectorAll("._5dr4"),n=0,o=m.length;o>n;n++)m[n].addEventListener("click",a.onFacebookColorClicked)},a.onFacebookColorClicked=function(b){var d=a.rgb2hex(b.target.style.backgroundColor);c.logEventData({eventCategory:"color",eventAction:"change_fb",eventLabel:d.toUpperCase()})},a.rgb2hex=function(a){var b=a.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);return b&&4===b.length?"#"+("0"+parseInt(b[1],10).toString(16)).slice(-2)+("0"+parseInt(b[2],10).toString(16)).slice(-2)+("0"+parseInt(b[3],10).toString(16)).slice(-2):a},a}();return g});