define(["require","exports","utils/browser-api","utils/facebook-utils","utils/enums","content-scripts/color-dialog"],function(a,b,c,d,e,f){"use strict";var g;return function(a){function b(){h.init(),h.startObserving()}var g,h=function(){function a(){}return a.getSelectedReceiver=function(a){if("undefined"==typeof a&&(a=document.querySelector("ul[role=grid] li._1ht1._1ht2"),a||(a=document.querySelector("ul[role=grid] li:first-of-type"))),a){var b,c,d=a.querySelector("[id^=row_header_id]").id,f=d.split(":");if(b=f[1],c=f[0].indexOf("user")>-1?e.FacebookConversationType.USER:e.FacebookConversationType.GROUP,b){var g={id:b,type:c};return g}}},a.init=function(){c.Message.sendMessage({cmd:"getCurrentUser"},function(a){a&&d.getFbDtsg(function(b){b&&(g={id:a,fbDtsg:b})})})},a.startObserving=function(){var b=!1,c=new MutationObserver(function(c){b||c.forEach(function(c){if(!b)for(var d=c.addedNodes.length,e=0;d>e;e++){var h=c.addedNodes[e];if("DIV"===h.nodeName&&h.classList.contains("uiLayer")){var i=h.querySelector("._gs4.uiGrid");if(i){var j=a.getSelectedReceiver();j&&f.render(i.parentElement,g,j)}}}})});c.observe(document.body,{childList:!0,subtree:!0})},a}();a.run=b}(g||(g={})),g});